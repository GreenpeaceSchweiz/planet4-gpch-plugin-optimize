(()=>{const e=(e,t,n)=>{const o=new URLSearchParams(window.location.search).get(e);if("is"===n){if(o&&o===t)return!0}else if("is_not"===n){if(o&&o!==t)return!0}else if("contains"===n){if(o&&o.includes(t))return!0}else if("does_not_contain"===n){if(o&&!o.includes(t))return!0}else if("exists"===n){if(null!==o)return!0}else if("does_not_exist"===n&&null===o)return!0;return!1},t=(e,t,n,o,i,a)=>{if(console.log(e,t,n,o,i,a),"local_storage"===e||"session_storage"===e){const r=("local_storage"===e?localStorage:sessionStorage).getItem(t);if("object"!==n){if("exists"===i)return null!==r;if("does_not_exist"===i)return null===r}else if("object"===n)if("exists"===i)try{const e=JSON.parse(r);return"object"==typeof e&&null!==e&&o in e}catch(e){return!1}else if("does_not_exist"===i)try{const e=JSON.parse(r);return"object"!=typeof e||null===e||!(o in e)}catch(e){return!0}if(null===r)return!1;if(console.log("storedValue",r),"string"===n){if("is"===i)return r===a;if("is_not"===i)return r!==a;if("contains"===i)return r.includes(a);if("does_not_contain"===i)return!r.includes(a)}else if("comma_separated"===n){const e=r.split(",").map((e=>e.trim()));if("contains"===i)return e.includes(a);if("does_not_contain"===i)return!e.includes(a)}else if("object"===n)try{const e=JSON.parse(r);if("object"!=typeof e||null===e)return!1;const t=e[o];if("is"===i)return t===a;if("is_not"===i)return t!==a;if("contains"===i&&"string"==typeof t)return t.includes(a);if("does_not_contain"===i&&"string"==typeof t)return!t.includes(a)}catch(e){return!1}}return!1},n=".gp-optimize-container";var o;(o=n,new Promise((e=>{if(document.querySelector(o))return e(document.querySelector(o));const t=new MutationObserver((()=>{document.querySelector(o)&&(t.disconnect(),e(document.querySelector(o)))}));t.observe(document.documentElement,{childList:!0,subtree:!0})}))).then((()=>{const o=document.querySelectorAll(n);console.log("Starting Optimize for blocks: ",o),o.forEach((n=>{if("true"===n.dataset.status&&void 0!==n.dataset.optimizationId){const o=n.querySelectorAll(".gp-optimize-variant");console.log("Variants: ",o);const i=((n,o)=>{let i=null;e:for(const n of o){if(new URLSearchParams(window.location.search).get("force_variant")===n.dataset.variantId){i=n.dataset.variantId;break e}if(void 0!==n.dataset.conditionals){const o=JSON.parse(n.dataset.conditionals);if("object"==typeof o)for(const a of o){let o=!1;if("url_parameter"===a.type?o=e(a.conditionalKey,a.value,a.operator):"local_storage"!==a.type&&"session_storage"!==a.type||(o=t(a.type,a.nameInStorage,a.dataType,a.conditionalKey,a.operator,a.value)),!0===o){i=n.dataset.variantId;break e}}}}if(null===i){const e=localStorage.getItem("gp-optimize-"+n);if(void 0!==e)for(const t of o)if(t.dataset.variantId===e)return console.log("Found stored variant ID: ",e),e;const t=[];for(const e of o){let n=parseInt(e.dataset.targetPercentage);isNaN(n)&&(n=50),t.push({variantId:e.dataset.variantId,weight:n})}console.log("Selected winning variant by weighted random. "),i=(e=>{const t=e.reduce(((e,t,n)=>{var o;return e.push(t.weight+(null!==(o=e[n-1])&&void 0!==o?o:0)),e}),[]),n=Math.random()*t.at(-1);return e[t.findIndex((e=>e>n))]})(t).variantId}return localStorage.setItem("gp-optimize-"+n,i),console.log("Selected winning variant: ",i),i})(n.dataset.optimizationId,o);let a;console.log("Winning variant for Optimization "+n.dataset.optimizationId+" is "+i);for(const e of o)e.dataset.variantId===i?(e.style.display="block",a=e):(e.style.display="none",e.remove());const r=n.dataset.optimizationName||n.dataset.optimizationId;"undefined"!=typeof Planet4GpchPluginOptimizeSettings&&("mixpanel"===Planet4GpchPluginOptimizeSettings.event_type?void 0!==window.mixpanel&&(console.log("Sending event to Mixpanel"),window.mixpanel.track("$experiment_started",{"Experiment name":r,"Variant name":a.dataset.variantName})):"datalayer"===Planet4GpchPluginOptimizeSettings.event_type&&(window.dataLayer=window.dataLayer||[],console.log("Sending event to DataLayer"),window.dataLayer.push({event:Planet4GpchPluginOptimizeSettings.datalayer_event_name,experiment_name:r,variant_name:a.dataset.variantName})))}}))}))})();
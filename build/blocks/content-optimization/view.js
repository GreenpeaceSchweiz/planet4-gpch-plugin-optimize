(()=>{const e=(e,t,n)=>{const a=new URLSearchParams(window.location.search).get(e);if("is"===n){if(a&&a===t)return!0}else if("is_not"===n){if(a&&a!==t)return!0}else if("contains"===n){if(a&&a.includes(t))return!0}else if("does_not_contain"===n&&a&&!a.includes(t))return!0;return!1},t=".gp-optimize-container";var n;(n=t,new Promise((e=>{if(document.querySelector(n))return e(document.querySelector(n));const t=new MutationObserver((()=>{document.querySelector(n)&&(t.disconnect(),e(document.querySelector(n)))}));t.observe(document.documentElement,{childList:!0,subtree:!0})}))).then((()=>{const n=document.querySelectorAll(t);console.log("Starting Optimize for blocks: ",n),n.forEach((t=>{if("true"===t.dataset.status&&void 0!==t.dataset.optimizationId){const n=t.querySelectorAll(".gp-optimize-variant");console.log("Variants: ",n);const a=((t,n)=>{let a=null;e:for(const t of n)if(void 0!==t.dataset.conditionals){const n=JSON.parse(t.dataset.conditionals);if("object"==typeof n)for(const i of n)if("url_parameter"===i.type&&!0===e(i.conditionalKey,i.value,i.operator)){a=t.dataset.variantId,console.log("Selected winning variant by URL parameter conditional",i.conditionalKey,i.operator,i.value,a);break e}}if(null===a){const e=localStorage.getItem("gp-optimize-"+t);if(void 0!==e)for(const t of n)if(t.dataset.variantId===e)return console.log("Found stored variant ID: ",e),e;const i=[];for(const e of n){let t=parseInt(e.dataset.targetPercentage);isNaN(t)&&(t=50),i.push({variantId:e.dataset.variantId,weight:t})}console.log("Selected winning variant by weighted random. "),a=(e=>{const t=e.reduce(((e,t,n)=>{var a;return e.push(t.weight+(null!==(a=e[n-1])&&void 0!==a?a:0)),e}),[]),n=Math.random()*t.at(-1);return e[t.findIndex((e=>e>n))]})(i).variantId}return localStorage.setItem("gp-optimize-"+t,a),console.log("Selected winning variant: ",a),a})(t.dataset.optimizationId,n);let i;console.log("Winning variant for Optimization "+t.dataset.optimizationId+" is "+a);for(const e of n)e.dataset.variantId===a?(e.style.display="block",i=e):e.style.display="none";const o=t.dataset.optimizationName||t.dataset.optimizationId;"undefined"!=typeof Planet4GpchPluginOptimizeSettings&&("mixpanel"===Planet4GpchPluginOptimizeSettings.event_type?void 0!==window.mixpanel&&(console.log("Sending event to Mixpanel"),window.mixpanel.track("$experiment_started",{"Experiment name":o,"Variant name":i.dataset.variantName})):"datalayer"===Planet4GpchPluginOptimizeSettings.event_type&&(window.dataLayer=window.dataLayer||[],console.log("Sending event to DataLayer"),window.dataLayer.push({event:Planet4GpchPluginOptimizeSettings.datalayer_event_name,experiment_name:o,variant_name:i.dataset.variantName})))}}))}))})();